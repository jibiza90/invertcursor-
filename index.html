<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PORTFOLIO MANAGER | Premium Investment Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="static/app.css?v=3">
    <link rel="stylesheet" href="static/animations.css?v=3">
    <link rel="stylesheet" href="static/loading.css?v=2.9.16">
    <link rel="stylesheet" href="static/virtual-scroll.css?v=1">
    <link rel="stylesheet" href="static/incremental-controls.css?v=1">
    <!-- CSS de Pesta√±as Avanzadas -->
    <link rel="stylesheet" href="tabs-styles.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüíé%3C/text%3E%3C/svg%3E">
</head>
<body>
    <!-- Indicador de carga global -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
            <div class="loading-text">Cargando Portfolio Manager...</div>
            <div id="loadingProgress" class="loading-progress" style="display: none;">
                <div class="progress-text"></div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill"></div>
                </div>
                <div class="progress-time"></div>
            </div>
        </div>
    </div>

    <!-- ESTRUCTURA DE PESTA√ëAS AVANZADAS -->
    <div id="tabs-container" class="tabs-container">
        <!-- Navegaci√≥n de Pesta√±as -->
        <div class="tabs-navigation">
            <button class="tab-button active" data-tab="dashboard">
                üè† Dashboard
            </button>
            <button class="tab-button" data-tab="analytics">
                üìà An√°lisis Avanzado
            </button>
            <button class="tab-button" data-tab="reporting">
                üìã Reporting
            </button>
            <button class="tab-button" data-tab="visualizations">
                üé® Visualizaciones
            </button>
            <button class="tab-button" data-tab="import-export">
                üì§ Import/Export
            </button>
            <button class="tab-button" data-tab="data-quality">
                üîç Calidad Datos
            </button>
            <button class="tab-button" data-tab="settings">
                ‚öôÔ∏è Configuraci√≥n
            </button>
        </div>

        <!-- Contenido de Pesta√±as -->
        <div class="tabs-content">
            
            <!-- PESTA√ëA 1: DASHBOARD (EXISTENTE - SIN MODIFICAR) -->
            <div id="tab-dashboard" class="tab-content active">
                <!-- EL CONTENIDO EXISTENTE SE CARGAR√Å AQU√ç AUTOM√ÅTICAMENTE -->
                <div id="existing-content-wrapper">
                    <!-- TODO EL CONTENIDO ACTUAL SE MANTENDR√Å AQU√ç -->
                </div>
            </div>

            <!-- PESTA√ëA 2: AN√ÅLISIS AVANZADO -->
            <div id="tab-analytics" class="tab-content">
                <div class="tab-header">
                    <h2>üìà An√°lisis Avanzado</h2>
                </div>
                
                <!-- Sub-pesta√±as de An√°lisis -->
                <div class="sub-tabs">
                    <button class="sub-tab-button active" data-sub-tab="comparison">
                        Comparaci√≥n Multi-Cliente
                    </button>
                    <button class="sub-tab-button" data-sub-tab="metrics">
                        M√©tricas Profesionales
                    </button>
                    <button class="sub-tab-button" data-sub-tab="projections">
                        Proyecciones
                    </button>
                </div>

                <!-- Contenido de Sub-pesta√±as -->
                <div class="sub-tabs-content">
                    <div id="sub-tab-comparison" class="sub-tab-content active">
                        <div class="analytics-section">
                            <h3>üîç Comparaci√≥n Multi-Cliente</h3>
                            <div id="multi-client-comparison">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <p>Cargando an√°lisis comparativo...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="sub-tab-metrics" class="sub-tab-content">
                        <div class="analytics-section">
                            <h3>üìä M√©tricas Profesionales</h3>
                            <div id="professional-metrics">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <p>Calculando m√©tricas avanzadas...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="sub-tab-projections" class="sub-tab-content">
                        <div class="analytics-section">
                            <h3>üéØ Proyecciones</h3>
                            <div id="projections-analysis">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <p>Generando proyecciones...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PESTA√ëA 3: REPORTING -->
            <div id="tab-reporting" class="tab-content">
                <div class="tab-header">
                    <h2>üìã Reporting Profesional</h2>
                </div>
                
                <!-- Sub-pesta√±as de Reporting -->
                <div class="sub-tabs">
                    <button class="sub-tab-button active" data-sub-tab="pdf-reports">
                        Informes PDF
                    </button>
                    <button class="sub-tab-button" data-sub-tab="executive-dashboard">
                        Dashboard Ejecutivo
                    </button>
                    <button class="sub-tab-button" data-sub-tab="history">
                        Historial Completo
                    </button>
                </div>

                <!-- Contenido de Sub-pesta√±as -->
                <div class="sub-tabs-content">
                    <div id="sub-tab-pdf-reports" class="sub-tab-content active">
                        <div class="reporting-section">
                            <h3>üìÑ Generador de Informes PDF</h3>
                            <div id="pdf-generator">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <p>Preparando generador de informes...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="sub-tab-executive-dashboard" class="sub-tab-content">
                        <div class="reporting-section">
                            <h3>üéØ Dashboard Ejecutivo</h3>
                            <div id="executive-dashboard">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <p>Cargando dashboard ejecutivo...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="sub-tab-history" class="sub-tab-content">
                        <div class="reporting-section">
                            <h3>üìã Historial Completo</h3>
                            <div id="complete-history">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <p>Cargando historial de operaciones...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PESTA√ëA 4: VISUALIZACIONES -->
            <div id="tab-visualizations" class="tab-content">
                <div class="tab-header">
                    <h2>üé® Visualizaciones Interactivas</h2>
                </div>
                
                <!-- Sub-pesta√±as de Visualizaciones -->
                <div class="sub-tabs">
                    <button class="sub-tab-button active" data-sub-tab="3d-charts">
                        Gr√°ficos 3D
                    </button>
                    <button class="sub-tab-button" data-sub-tab="heatmaps">
                        Heatmaps
                    </button>
                    <button class="sub-tab-button" data-sub-tab="animations">
                        Animaciones
                    </button>
                </div>

                <!-- Contenido de Sub-pesta√±as -->
                <div class="sub-tabs-content">
                    <div id="sub-tab-3d-charts" class="sub-tab-content active">
                        <div class="visualization-section">
                            <h3>üéÆ Gr√°ficos 3D</h3>
                            <div id="3d-charts-container">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <p>Preparando visualizaci√≥n 3D...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="sub-tab-heatmaps" class="sub-tab-content">
                        <div class="visualization-section">
                            <h3>üî• Heatmaps</h3>
                            <div id="heatmaps-container">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <p>Generando mapas de calor...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="sub-tab-animations" class="sub-tab-content">
                        <div class="visualization-section">
                            <h3>‚ú® Animaciones</h3>
                            <div id="animations-container">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <p>Preparando animaciones...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PESTA√ëA 5: IMPORT/EXPORT -->
            <div id="tab-import-export" class="tab-content">
                <div class="tab-header">
                    <h2>üì§ Import/Export Seguro</h2>
                </div>
                
                <!-- Sub-pesta√±as de Import/Export -->
                <div class="sub-tabs">
                    <button class="sub-tab-button active" data-sub-tab="export">
                        Exportar Datos
                    </button>
                    <button class="sub-tab-button" data-sub-tab="import">
                        Importar Datos
                    </button>
                </div>

                <!-- Contenido de Sub-pesta√±as -->
                <div class="sub-tabs-content">
                    <div id="sub-tab-export" class="sub-tab-content active">
                        <div class="import-export-section">
                            <h3>üì§ Exportar Datos</h3>
                            <div id="export-controls">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <p>Preparando opciones de exportaci√≥n...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="sub-tab-import" class="sub-tab-content">
                        <div class="import-export-section">
                            <h3>üì• Importar Datos</h3>
                            <div id="import-controls">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <p>Preparando opciones de importaci√≥n...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PESTA√ëA 6: CALIDAD DE DATOS -->
            <div id="tab-data-quality" class="tab-content">
                <div class="tab-header">
                    <h2>üîç Calidad de Datos</h2>
                </div>
                
                <!-- Sub-pesta√±as de Calidad -->
                <div class="sub-tabs">
                    <button class="sub-tab-button active" data-sub-tab="validation">
                        Validaci√≥n
                    </button>
                    <button class="sub-tab-button" data-sub-tab="cleaning">
                        Limpieza
                    </button>
                </div>

                <!-- Contenido de Sub-pesta√±as -->
                <div class="sub-tabs-content">
                    <div id="sub-tab-validation" class="sub-tab-content active">
                        <div class="data-quality-section">
                            <h3>‚ö†Ô∏è Validaci√≥n Autom√°tica</h3>
                            <div id="validation-controls">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <p>Analizando calidad de datos...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="sub-tab-cleaning" class="sub-tab-content">
                        <div class="data-quality-section">
                            <h3>üßπ Data Cleaning</h3>
                            <div id="cleaning-controls">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <p>Preparando herramientas de limpieza...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PESTA√ëA 7: CONFIGURACI√ìN -->
            <div id="tab-settings" class="tab-content">
                <div class="tab-header">
                    <h2>‚öôÔ∏è Configuraci√≥n</h2>
                </div>
                
                <!-- Sub-pesta√±as de Configuraci√≥n -->
                <div class="sub-tabs">
                    <button class="sub-tab-button active" data-sub-tab="themes">
                        Temas
                    </button>
                    <button class="sub-tab-button" data-sub-tab="responsive">
                        Responsive
                    </button>
                </div>

                <!-- Contenido de Sub-pesta√±as -->
                <div class="sub-tabs-content">
                    <div id="sub-tab-themes" class="sub-tab-content active">
                        <div class="settings-section">
                            <h3>üåì Temas Personalizados</h3>
                            <div id="theme-controls">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <p>Cargando opciones de tema...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="sub-tab-responsive" class="sub-tab-content">
                        <div class="settings-section">
                            <h3>üì± Optimizaci√≥n Responsive</h3>
                            <div id="responsive-controls">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <p>Cargando opciones responsive...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="container">
        <header>
            <h1>PORTFOLIO MANAGER <span style="font-size: 0.5em; color: #888; font-weight: 400;">V2.9.27</span></h1>
            <div class="header-actions">
                <select id="selectorHoja" class="selector-hoja">
                    <option value="Diario STD">Diario STD</option>
                    <option value="Diario VIP">Diario VIP</option>
                    <option value="Diario WIND" selected>Diario WIND</option>
                    <option value="Diario Xavi">Diario Xavi</option>
                </select>
                <select id="selectorMes" class="selector-mes">
                    <option value="">-- Mes --</option>
                </select>
                <div class="mes-nav">
                    <button id="btnMesAnterior" class="btn btn-secondary btn-mes">Mes anterior</button>
                    <button id="btnMesSiguiente" class="btn btn-secondary btn-mes">Mes siguiente</button>
                </div>
                <select id="selectorCliente" class="selector-cliente">
                    <option value="">-- Selecciona un Cliente --</option>
                </select>
                <button id="btnUndo" class="btn btn-secondary" title="Deshacer (Ctrl+Z)">‚Ü© Atr√°s</button>
                <button id="btnRedo" class="btn btn-secondary" title="Rehacer (Ctrl+Y)">‚Ü™ Rehacer</button>
                <button id="btnActualizarTodo" class="btn btn-accent" title="Recalcular todas las casillas">‚ü≥ Actualizar</button>
                <button id="btnGuardar" class="btn btn-primary">Guardar Cambios</button>
                <button id="btnExportar" class="btn btn-secondary">Exportar JSON</button>
            </div>
        </header>

        <div class="main-content">
            <!-- Panel de navegaci√≥n -->
            <aside class="sidebar">
                <h2>Navegaci√≥n</h2>
                <div class="nav-menu">
                    <button class="nav-btn active" data-vista="general" id="btnVistaGeneral">
                        Vista General
                    </button>
                    <button class="nav-btn" data-vista="clientes" id="btnVistaClientes">
                        Clientes
                    </button>
                    <button class="nav-btn" data-vista="infoClientes" id="btnVistaInfoClientes">
                        Info Clientes
                    </button>
                    <button class="nav-btn" data-vista="comision" id="btnVistaComision">
                        Comisi√≥n
                    </button>
                    <button class="nav-btn" data-vista="estadisticas" id="btnVistaEstadisticas">
                        üìä Estad√≠sticas
                    </button>
                </div>
                
                <!-- B√∫squeda de clientes (solo visible en vista clientes) -->
                <div class="search-box" id="busquedaClientes" style="display: none;">
                    <input type="text" id="buscarClienteSidebar" placeholder="üîç Buscar cliente...">
                </div>
                <div class="client-list" id="listaClientes" style="display: none;">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </aside>

            <!-- √Årea principal -->
            <main class="content-area">
                <!-- Vista General -->
                <div id="vistaGeneral" class="view active">
                    <div class="view-header-premium">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <h2>Resumen del Portafolio</h2>
                            <button id="btnLimpiarFiltro" class="btn btn-secondary" style="background: linear-gradient(135deg, #ff9a56 0%, #ff7e5f 100%); color: white; border: none;">Limpiar datos</button>
                        </div>
                        <div class="filters-bar">
                            <div class="filter-group">
                                <label>Desde:</label>
                                <input type="date" id="fechaDesde" class="date-filter">
                            </div>
                            <div class="filter-group">
                                <label>Hasta:</label>
                                <input type="date" id="fechaHasta" class="date-filter">
                            </div>
                            <button id="btnAplicarFiltro" class="btn btn-primary">Aplicar Filtro</button>
                            <button id="btnLimpiarFiltroFechas" class="btn btn-secondary">Limpiar filtro</button>
                            <button id="btnToggleVista" class="btn btn-secondary">Ver Resumen</button>
                        </div>
                    </div>
                    
                    <div class="summary-cards-premium" id="summaryCards">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                    
                    <div class="table-container-premium" id="tablaGeneralContainer">
                        <table id="tablaGeneral" class="data-table">
                            <thead id="theadGeneral">
                                <!-- Se llenar√° din√°micamente -->
                            </thead>
                            <tbody id="tbodyGeneral">
                                <!-- Se llenar√° din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Vista Clientes (Lista) -->
                <div id="vistaClientes" class="view">
                    <div class="view-header">
                        <button id="btnVolverGeneralDesdeClientes" class="btn btn-primary">üè† Vista General</button>
                        <h2>Lista de Clientes</h2>
                    </div>
                    <div class="clientes-toolbar">
                        <div class="clientes-toolbar-left">
                            <select id="selectorPlantillaCliente" class="selector-cliente">
                                <option value="">Plantilla: √∫ltimo cliente</option>
                            </select>
                            <button id="btnAgregarCliente" class="btn btn-accent">Ôºã Agregar nuevo cliente</button>
                            <input id="buscarCliente" class="selector-cliente clientes-search-input" type="text" placeholder="Buscar cliente...">
                        </div>
                        <div class="clientes-toolbar-right">
                            <label for="ordenClientes" class="stat-label">Ordenar</label>
                            <select id="ordenClientes" class="selector-cliente">
                                <option value="numero_asc">N√∫mero: Menor a mayor</option>
                                <option value="numero_desc">N√∫mero: Mayor a menor</option>
                                <option value="saldo_desc">Saldo: Mayor a menor</option>
                                <option value="saldo_asc">Saldo: Menor a mayor</option>
                                <option value="comision_desc">Comisi√≥n (si retira): Mayor a menor</option>
                                <option value="comision_asc">Comisi√≥n (si retira): Menor a mayor</option>
                                <option value="garantia_desc">Garant√≠a: Mayor a menor</option>
                                <option value="garantia_asc">Garant√≠a: Menor a mayor</option>
                            </select>
                        </div>
                    </div>
                    <div class="stats-bar">
                        <div class="stat">
                            <span class="stat-label">Total Clientes:</span>
                            <span class="stat-value" id="totalClientes">0</span>
                        </div>
                    </div>
                    <div class="summary-cards-premium" id="clientesKpis"></div>
                    <div class="clientes-cards-grid" id="clientesCards"></div>
                </div>

                <!-- Vista Detalle Cliente -->
                <div id="vistaDetalle" class="view">
                    <div class="view-header">
                        <button id="btnVolver" class="btn btn-back">‚Üê Volver</button>
                        <button id="btnVolverGeneral" class="btn btn-primary" style="margin-left: 10px;">üè† Vista General</button>
                        <button id="btnEliminarCliente" class="btn btn-danger" style="margin-left: 10px;">üóë Eliminar cliente</button>
                        <button id="btnEstadisticasCliente" class="btn btn-stats-client" style="margin-left: 10px;">üìä Estad√≠sticas del Cliente</button>
                        <h2 id="tituloCliente">Cliente <span id="numeroCliente">1</span></h2>
                    </div>
                    
                    <!-- Resumen de c√°lculos del cliente (oculto por defecto) -->
                    <div class="client-summary" id="resumenCliente" style="display: none;">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                    
                    <!-- Tabla con datos editables -->
                    <div class="table-container table-container-scroll">
                        <table id="tablaDetalle" class="data-table editable-table">
                            <thead id="theadDetalle">
                                <!-- Se llenar√° din√°micamente -->
                            </thead>
                            <tbody id="tbodyDetalle">
                                <!-- Se llenar√° din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Vista Info Clientes -->
                <div id="vistaInfoClientes" class="view">
                    <div class="view-header-premium">
                        <h2>Informaci√≥n de Clientes</h2>
                        <div class="info-clientes-controls">
                            <input type="text" id="buscarInfoCliente" placeholder="üîç Buscar cliente..." class="search-input">
                            <div class="tabs-container">
                                <button class="tab-btn active" data-hoja="Diario STD" id="tabSTD">Diario STD</button>
                                <button class="tab-btn" data-hoja="Diario VIP" id="tabVIP">Diario VIP</button>
                                <button class="tab-btn" data-hoja="Diario WIND" id="tabWIND">Diario WIND</button>
                                <button class="tab-btn" data-hoja="Diario Xavi" id="tabXavi">Diario Xavi</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-clientes-container" id="infoClientesContainer">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                </div>

                <!-- Vista Comisi√≥n -->
                <div id="vistaComision" class="view">
                    <div class="view-header-premium">
                        <div class="view-header-left">
                            <h2>C√°lculo de Comisiones</h2>
                            <input type="text" id="buscarComision" placeholder="üîç Buscar cliente..." class="search-input">
                        </div>
                        <div class="tabs-container">
                            <button class="tab-btn active" data-hoja="Diario STD" id="tabSTDComision">Diario STD</button>
                            <button class="tab-btn" data-hoja="Diario VIP" id="tabVIPComision">Diario VIP</button>
                            <button class="tab-btn" data-hoja="Diario WIND" id="tabWINDComision">Diario WIND</button>
                            <button class="tab-btn" data-hoja="Diario Xavi" id="tabXaviComision">Diario Xavi</button>
                        </div>
                    </div>
                    
                    <div class="comision-container" id="comisionContainer">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                </div>

                <!-- Vista Estad√≠sticas -->
                <div id="vistaEstadisticas" class="view">
                    <div class="view-header-premium">
                        <div class="view-header-left">
                            <h2>üìä Estad√≠sticas de Rentabilidad</h2>
                        </div>
                        <div class="tabs-container">
                            <button class="tab-btn active" data-hoja="Diario STD" id="tabSTDStats">Diario STD</button>
                            <button class="tab-btn" data-hoja="Diario VIP" id="tabVIPStats">Diario VIP</button>
                            <button class="tab-btn" data-hoja="Diario WIND" id="tabWINDStats">Diario WIND</button>
                            <button class="tab-btn" data-hoja="Diario Xavi" id="tabXaviStats">Diario Xavi</button>
                        </div>
                    </div>
                    
                    <div class="estadisticas-container" id="estadisticasContainer">
                        <!-- Controles Premium -->
                        <div class="chart-controls-premium">
                            <div class="control-group">
                                <label>Tipo de gr√°fico:</label>
                                <select id="tipoGrafico">
                                    <option value="bar" selected>Barras</option>
                                    <option value="line">L√≠nea</option>
                                    <option value="radar">Radar</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>Periodo:</label>
                                <select id="periodoStats">
                                    <option value="all" selected>Todo el a√±o</option>
                                    <option value="12">√öltimos 12 meses</option>
                                    <option value="6">√öltimos 6 meses</option>
                                    <option value="3">√öltimos 3 meses</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>Vista:</label>
                                <div class="toggle-group">
                                    <button class="toggle-btn active" id="btnVistaMensual">Mensual</button>
                                    <button class="toggle-btn" id="btnVistaAcumulado">Acumulado</button>
                                </div>
                            </div>
                            <div class="control-group">
                                <label>Benchmark:</label>
                                <input type="number" id="benchmarkInput" value="2" min="0" max="10" step="0.1" style="width:60px"> %/mes
                            </div>
                            <button class="btn-export" id="btnExportarGrafico" title="Exportar como imagen">
                                üì• Exportar
                            </button>
                        </div>

                        <!-- Gr√°fico Principal -->
                        <div class="chart-wrapper-premium">
                            <canvas id="chartRentabilidad"></canvas>
                        </div>

                        <!-- Resumen de KPIs -->
                        <div class="stats-summary-premium" id="statsSummary">
                            <!-- Se llenar√° din√°micamente -->
                        </div>

                        <!-- Indicadores Avanzados -->
                        <div class="stats-indicators" id="statsIndicators">
                            <!-- Se llenar√° din√°micamente -->
                        </div>

                        <!-- Tabla Detallada -->
                        <div class="stats-table-container">
                            <h3>üìã Detalle Mensual</h3>
                            <table class="stats-table" id="statsTable">
                                <thead>
                                    <tr>
                                        <th>Mes</th>
                                        <th>Rentabilidad</th>
                                        <th>Acumulado</th>
                                        <th>vs Benchmark</th>
                                        <th>Tendencia</th>
                                    </tr>
                                </thead>
                                <tbody id="statsTableBody">
                                    <!-- Se llenar√° din√°micamente -->
                                </tbody>
                            </table>
                        </div>


                        <!-- Proyecci√≥n -->
                        <div class="stats-projection" id="statsProjection">
                            <!-- Se llenar√° din√°micamente -->
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Modal de confirmaci√≥n -->
        <div id="modalConfirmacion" class="modal">
            <div class="modal-content">
                <h3>Confirmar Cambios</h3>
                <p>¬øEst√°s seguro de que quieres guardar los cambios?</p>
                <div class="modal-actions">
                    <button class="btn btn-primary" id="confirmarGuardar">S√≠, Guardar</button>
                    <button class="btn btn-secondary" id="cancelarGuardar">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Notificaci√≥n -->
        <div id="notificacion" class="notificacion"></div>
    </div>

    <!-- Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- M√≥dulos de utilidades -->
    <script src="js/utils/fechas.js?v=2.9.18"></script>
    <script src="js/utils/numeros.js?v=2.9.18"></script>
    <script src="js/core/calculadora.js?v=2.9.18"></script>
    
    <!-- Optimizaciones de rendimiento -->
    <script src="static/cache-manager.js?v=1"></script>
    <script src="static/render-optimizer.js?v=1"></script>
    <script src="static/virtual-scroll.js?v=1"></script>
    <script src="static/incremental-updater.js?v=1"></script>
    <script src="static/incremental-controls.js?v=1"></script>
    
    <!-- Web Workers -->
    <script>
        // Inicializar Web Worker para c√°lculos pesados
        let calculationsWorker = null;
        
        function initCalculationsWorker() {
            if (typeof Worker !== 'undefined') {
                calculationsWorker = new Worker('static/calculations-worker.js?v=1');
                
                calculationsWorker.onmessage = function(e) {
                    const { type, result, error } = e.data;
                    
                    if (error) {
                        console.error('Error en Web Worker:', error);
                        return;
                    }
                    
                    // Manejar resultados del worker
                    switch(type) {
                        case 'recalcularSaldos':
                            window.handleWorkerSaldos?.(result);
                            break;
                        case 'calcularEstadisticas':
                            window.handleWorkerEstadisticas?.(result);
                            break;
                        case 'procesarDatosCliente':
                            window.handleWorkerCliente?.(result);
                            break;
                    }
                };
                
                console.log('üöÄ Web Worker de c√°lculos inicializado');
            } else {
                console.warn('‚ö†Ô∏è Web Workers no soportados');
            }
        }
        
        // Inicializar al cargar la p√°gina
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initCalculationsWorker);
        } else {
            initCalculationsWorker();
        }
    </script>
    
    <!-- Scripts de Pesta√±as Avanzadas -->
    <script src="tabs-core.js"></script>
    <script src="analytics-advanced.js"></script>
    
    <!-- Bibliotecas adicionales para funcionalidades avanzadas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Script de Integraci√≥n Autom√°tica -->
    <script>
    // INTEGRACI√ìN AUTOM√ÅTICA SEGURA
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Iniciando integraci√≥n autom√°tica de pesta√±as...');
        
        // Mover contenido existente al wrapper de forma segura
        setTimeout(() => {
            const existingContent = document.querySelector('body > .container');
            const dashboardWrapper = document.getElementById('existing-content-wrapper');
            
            if (existingContent && dashboardWrapper) {
                dashboardWrapper.appendChild(existingContent);
                console.log('‚úÖ Contenido existente integrado seguramente');
            } else {
                console.warn('‚ö†Ô∏è No se encontr√≥ contenido existente para integrar');
            }
        }, 100);
        
        // Configurar atajos de teclado
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        window.tabsSystem?.switchToTab('dashboard');
                        break;
                    case '2':
                        e.preventDefault();
                        window.tabsSystem?.switchToTab('analytics');
                        break;
                    case '3':
                        e.preventDefault();
                        window.tabsSystem?.switchToTab('reporting');
                        break;
                    case '4':
                        e.preventDefault();
                        window.tabsSystem?.switchToTab('visualizations');
                        break;
                    case '5':
                        e.preventDefault();
                        window.tabsSystem?.switchToTab('import-export');
                        break;
                    case '6':
                        e.preventDefault();
                        window.tabsSystem?.switchToTab('data-quality');
                        break;
                    case '7':
                        e.preventDefault();
                        window.tabsSystem?.switchToTab('settings');
                        break;
                }
            }
        });
        
        console.log('‚úÖ Integraci√≥n de pesta√±as completada');
    });
    </script>
    
    <!-- Aplicaci√≥n principal -->
    <script src="app.js?v=2.9.21"></script>
    <script src="test_recalculo.js?v=2.9.18"></script>
</body>
</html>
